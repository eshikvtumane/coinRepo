{% extends 'base.html' %}
{% block content %}
<form id='search-form'>
    {% csrf_token %}
    <div id='countries'>
    <select id='select-country'>
        {% for country in countries %}
            <option value="{{country.id}}">{{country.country_name}}</option>
        {% endfor %}
    </select>
    </div>
    </br>
    <div id='mints'></div>
  </form>
<script type="text/javascript">
    $(document).ready(function(){

   {% comment %} function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie != '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = jQuery.trim(cookies[i]);
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) == (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

    var csrftoken = getCookie("csrftoken");

    function csrfSafeMethod(method) {
    // these HTTP methods do not require CSRF protection
    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
    beforeSend: function(xhr, settings) {
        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }
    }
});{% endcomment %}

        $('#select-country').change(function(){
            $.ajax({
                url: '{% url 'country-ajax' %}',
                type: 'GET',
                dataType: 'json',
                data: {
                    //csrfmiddlewaretoken: '{{ csrf_token }}'
                    'country':  $(this).val()
                },
                success:function(json){
                    $('#mints').html("");
                    $('<select>',{
                      'id':'mint-select'
                    }).appendTo('#mints');
                    for (i = 0;i<json.length;i++)
                    {
                        $('<option>',{
                            'value':json[i].fields.id,
                            'html': json[i].fields.mint_abbreviation
                        }).appendTo('#mint-select');
                    }

                },

                error:function(){
                    alert("Error!")
                }
            });
        });

})

</script>
{% endblock %}

